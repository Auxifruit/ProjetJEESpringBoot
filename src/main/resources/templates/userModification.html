<!DOCTYPE html>
<html lang="fr" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>Modification d'utilisateur</title>
  <link rel="stylesheet" href="${pageContext.request.contextPath}/css/styles.css">
</head>
<body>
<div th:include="~{elements/sidebar}"></div>

<div>
  <h1>Modification d'un utilisateur</h1>

  <!-- Vérification de l'autorisation d'accès -->
  <div th:if="${user == null or user.user_Role != T(com.example.projetjee.model.entities.Role).administrator}">
    <p>Accès refusé. Vous n'êtes pas administrateur.</p>
  </div>

  <div th:if="${user != null}">
    <h3>Anciennes informations</h3>
    <p>Ancien nom : <span th:text="${user.userLastName}"></span></p>
    <p>Ancien prénom : <span th:text="${user.userName}"></span></p>
    <p>Ancien email : <span th:text="${user.userEmail}"></span></p>
    <p>Ancienne date de naissance : <span th:text="${user.user_Birthdate}"></span></p>

    <!-- Pour les étudiants : afficher classe et filière -->
    <div th:if="${user.user_Role == T(com.example.projetjee.model.entities.Role).student}">
      <p>Ancienne classe :
        <span th:text="${user.student != null and user.student.className != null ? user.student.className : 'Sans classe'}"></span>
      </p>
      <p>Ancienne filière :
        <span th:text="${user.student != null and user.student.majorName != null ? user.student.majorName : 'Sans filière'}"></span>
      </p>
    </div>

    <p>Ancien rôle : <span th:text="${user.user_Role}"></span></p>
  </div>

  <form th:action="@{/userModification-servlet}" method="post">
    <h3>Nouvelles informations</h3>

    <!-- Champs de modification des informations -->
    <label>Nouveau nom : </label>
    <input type="text" name="userNewLastName" th:value="${user.userLastName}" required>

    <label>Nouveau prénom : </label>
    <input type="text" name="userNewName" th:value="${user.userName}" required>

    <label>Nouveau email : </label>
    <input type="text" name="userNewEmail" th:value="${user.userEmail}" required>

    <label>Nouvelle date de naissance : </label>
    <input type="date" name="userNewBirthdate" th:value="${user.user_Birthdate}" required>

    <!-- Pour les étudiants : sélectionner classe et filière -->
    <div th:if="${user.user_Role == T(com.example.projetjee.model.entities.Role).student}">
      <label>Nouvelle classe : </label>
      <select name="userNewClassesId">
        <option value="">Ne pas changer la classe</option>
        <option th:each="classe : ${classesList}" th:value="${classe.classId}" th:text="${classe.className}"></option>
      </select>

      <label>Nouvelle filière : </label>
      <select name="userNewMajorId">
        <option value="">Ne pas changer la filière</option>
        <option th:each="major : ${majorList}" th:value="${major.marjorId}" th:text="${major.majorName}"></option>
      </select>
    </div>

    <!-- Modifier le rôle -->
    <label>Nouveau rôle : </label>
    <select name="userNewRole">
      <option value="" th:selected="${user.user_Role == null}">Ne pas changer le rôle</option>
      <option value="student" th:selected="${user.user_Role == T(com.example.projetjee.model.entities.Role).student}">Étudiants</option>
      <option value="teacher" th:selected="${user.user_Role == T(com.example.projetjee.model.entities.Role).teacher}">Enseignants</option>
      <option value="administrator" th:selected="${user.user_Role == T(com.example.projetjee.model.entities.Role).administrator}">Administrateurs</option>
    </select>

    <input type="hidden" name="userId" th:value="${user.userId}">

    <!-- Message d'erreur -->
    <div th:if="${messageErreur != null and messageErreur != ''}">
      <p style="color: red" th:text="${messageErreur}"></p>
    </div>

    <button type="submit" onclick="confirmModify(event)">Modifier</button>
  </form>
</div>

<script>
  // Confirmer la modification de l'utilisateur
  function confirmModify(event) {
    const confirmation = confirm("Êtes-vous sûr de vouloir modifier l'utilisateur ?");
    if (!confirmation) {
      event.preventDefault(); // Empêche l'envoi du formulaire
    }
  }
</script>
</body>
</html>
