<!DOCTYPE html>
<html lang="fr" xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>Inscription</title>
  <link rel="stylesheet" th:href="@{/css/styles.css}">
</head>
<body>
<div th:include="~{elements/sidebar}" />

<form action="#" th:action="@{/register}" method="post" onsubmit="validateForm(event)">
  <h1>Inscription</h1>

  <label for="firstName">Prénom :</label>
  <input type="text" name="firstName" id="firstName" placeholder="Prénom" required><br>

  <label for="lastName">Nom :</label>
  <input type="text" name="lastName" id="lastName" placeholder="Nom" required><br>

  <label for="email">Email :</label>
  <input type="email" name="email" id="email" placeholder="Email exemple@xyz.com" required><br>

  <label for="password">Mot de passe :</label>
  <input type="password" name="password" id="password" required><br>

  <label for="birthdate">Date de naissance :</label>
  <input type="date" name="birthdate" id="birthdate" required><br>

  <label for="role">Choix du role :</label>
  <select name="role" id="role" onchange="toggleMajorChoice()" required>
    <option th:value="${T(com.example.projetjee.model.entities.Role).student}" selected="selected">Étudiant</option>
    <option th:value="${T(com.example.projetjee.model.entities.Role).teacher}">Enseignant</option>
  </select><br>

  <!-- Liste des majors pour l'étudiant -->
  <div th:if="${not #lists.isEmpty(majors)}">
    <label for="major" class="majorChoice">Filière :</label>
    <select name="major" id="major" class="majorChoice">
      <option value="" selected="selected">Choisir une filière</option>
      <th:block th:each="major : ${majors}">
        <option th:value="${major.marjorId}" th:text="${major.majorName}"></option>
      </th:block>
    </select><br>
  </div>

  <button type="submit">S'inscrire</button>
  <p>Pas encore de compte ? <a th:href="@{/login}">Connectez-vous.</a></p>
</form>

<div th:if="${error != null}">
  <p style="color: red;">[[${error}]]</p>
</div>
<div th:if="${success != null}">
  <p style="color: green;">[[${success}]]</p>
</div>

<script>
  // Fonction pour afficher/masquer la sélection de filière en fonction du rôle
  function toggleMajorChoice() {
    const roleSelect = document.getElementById("role");
    const majorChoices = document.getElementsByClassName("majorChoice");
    const majorSelect = document.getElementById("major");

    if (roleSelect.value === "student") {
      for (let i = 0; i < majorChoices.length; i++) {
        majorChoices[i].style.display = "block";
      }
    } else {
      for (let i = 0; i < majorChoices.length; i++) {
        majorChoices[i].style.display = "none";
      }
      majorSelect.value = "";
    }
  }

  // Validation du formulaire avant soumission
  function validateForm(event) {
    const roleSelect = document.getElementById("role");
    const majorSelect = document.getElementById("major");
    if (roleSelect.value === "student" && majorSelect.value === "") {
      event.preventDefault(); // Empêche l'envoi du formulaire
      alert("Veuillez choisir une filière.");
    }
  }
</script>
</body>
</html>
