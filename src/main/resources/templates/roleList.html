<!DOCTYPE html>
<html lang="fr" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Liste des Utilisateurs</title>
</head>
<body>
<div th:include="~{elements/sidebar}"></div>

<h1>Liste des Utilisateurs</h1>

<div th:if="${user == null or not user.hasRole('administrator')}">
    <p>Accès refusé. Vous devez être administrateur pour accéder à cette page.</p>
    <a th:href="@{/index}">Retour à l'accueil</a>
</div>

<div th:if="${user != null and user.hasRole('administrator')}">
    <div th:if="${not #lists.isEmpty(users)}">
        <form action="changeRole-servlet" method="get">
            <span><b>Filtrer par : </b></span>
            <select name="roleFilter">
                <option value="">Tous</option>
                <option th:value="${T(com.example.projetjee.model.entities.Role).student}">Étudiants</option>
                <option th:value="${T(com.example.projetjee.model.entities.Role).teacher}">Enseignants</option>
                <option th:value="${T(com.example.projetjee.model.entities.Role).administrator}">Administrateurs</option>
            </select>
            <button type="submit">Valider</button>
        </form>
        <br><br>

        <form action="changeRole-servlet" method="post">
            <table border="1">
                <thead>
                <tr>
                    <th>Id Utilisateur</th>
                    <th>Nom</th>
                    <th>Prénom</th>
                    <th>Email</th>
                    <th>Rôle</th>
                    <th>Sélection</th>
                </tr>
                </thead>
                <tbody>
                <th:block th:each="user : ${users}">
                    <tr>
                        <td th:text="${user.userId}"></td>
                        <td th:text="${user.userLastName}"></td>
                        <td th:text="${user.userName}"></td>
                        <td th:text="${user.userEmail}"></td>
                        <td th:text="${user.user_Role}"></td>
                        <td><input type="radio" name="user" th:value="${user.userId}" required></td>
                    </tr>
                </th:block>
                </tbody>
            </table>
            <br>
            <span><b>Nouveau rôle : </b></span>
            <select name="newRoleID" required>
                <option th:value="${T(com.example.projetjee.model.entities.Role).student}">Étudiants</option>
                <option th:value="${T(com.example.projetjee.model.entities.Role).teacher}">Enseignants</option>
                <option th:value="${T(com.example.projetjee.model.entities.Role).administrator}">Administrateurs</option>
            </select>
            <button type="submit">Valider</button>
            <br><br>
        </form>
    </div>

    <div th:if="${#lists.isEmpty(users)}">
        <p>Aucun utilisateur trouvé.</p>
    </div>

    <div th:if="${error != null}">
        <p style="color: red;" th:text="${error}"></p>
    </div>
</div>
</body>
</html>
