<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>Gestion des Notes</title>
  <link rel="stylesheet" th:href="@{/Styles/style.css}">
  <style>
    body {
      font-family: Arial, sans-serif;
      display: flex;
      justify-content: center;
    }

    .container {
      width: 80%;
      margin: 20px;
      padding: 20px;
      border: 1px solid #ccc;
      border-radius: 8px;
      background-color: #f5f5f5;
    }

    .subject-buttons, .class-buttons {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
    }

    .subject-button, .class-button {
      padding: 10px;
      border-radius: 6px;
      color: white;
      border: none;
      cursor: pointer;
      background-color: #a0c4ff; /* Couleur bleue */
    }

    .subject-button.selected {
      background-color: #4a90e2; /* Couleur plus sombre lorsque sélectionné */
    }

    .class-button.selected {
      background-color: #4a90e2; /* Couleur plus sombre lorsque sélectionné */
    }

    /* Section formulaire pour ajouter une note */
    .form-section {
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin-bottom: 20px;
    }

    .input-field, .text-area {
      width: 100%;
      padding: 8px;
      border: 1px solid #ccc;
      border-radius: 4px;
    }

    .submit-button {
      padding: 10px;
      background-color: #32cd32;
      color: white;
      border: none;
      border-radius: 6px;
      cursor: pointer;
    }

    .notes-table, .note-entry, .student-note, .student-appreciation {
      margin-top: 20px;
    }
  </style>
  <script th:inline="javascript">
    function selectDiscipline(courseId) {
      const buttons = document.querySelectorAll('.subject-button');
      buttons.forEach(button => button.classList.remove('selected'));

      const selectedButton = document.getElementById('discipline-' + courseId);
      if (selectedButton) {
        selectedButton.classList.add('selected');
      }

      document.getElementById('selected-course-id').value = courseId;
    }

    function selectClass(classId) {
      const buttons = document.querySelectorAll('.class-button');
      buttons.forEach(button => button.classList.remove('selected'));

      const selectedButton = document.getElementById('class-' + classId);
      if (selectedButton) {
        selectedButton.classList.add('selected');
      }

      document.getElementById('selected-class-id').value = classId;
    }

    function validateCriteria() {
      const courseId = document.getElementById('selected-course-id').value;
      const classId = document.getElementById('selected-class-id').value;

      if (!courseId || !classId) {
        alert("Veuillez sélectionner un cours et une classe avant de continuer.");
        return false; // Empêche la soumission
      }

      document.getElementById('criteria-form').submit();
    }
  </script>
</head>
<body>
<div th:include="~{elements/sidebar}"></div>

<div class="container">

  <!-- Teacher -->
  <div th:if="${teacher != null}">
    <h2>Professeur: <span th:text="${teacher.userName}"></span> <span th:text="${teacher.userLastName}"></span></h2>
  </div>

  <!-- Discipline -->
  <div class="subject-buttons">
    <button th:each="discipline : ${disciplines}"
            type="button" class="subject-button"
            th:id="'discipline-' + ${discipline.courseId}"
            th:text="${discipline.courseName}"
            th:onclick="'selectDiscipline(' + ${discipline.courseId} + ')'">
    </button>
    <p th:if="${#lists.isEmpty(disciplines)}">Pas de matière disponible.</p>
  </div>

  <!-- Classes -->
  <div class="class-buttons">
    <button th:each="classe : ${classes}"
            type="button" class="class-button"
            th:id="'class-' + ${classe.classId}"
            th:text="${classe.className}"
            th:onclick="'selectClass(' + ${classe.classId} + ')'">
    </button>
    <p th:if="${#lists.isEmpty(classes)}">Pas de classe disponible.</p>
  </div>

  <!-- Formulaire POST pour envoyer les critères -->
  <form th:action="@{/entry-note-servlet}" method="POST" id="criteria-form">
    <input type="hidden" name="courseId" id="selected-course-id" value="">
    <input type="hidden" name="classId" id="selected-class-id" value="">
    <input type="hidden" name="teacherId" th:value="${teacherId}">
    <button type="submit" id="submit-button" th:onclick="|validateCriteria()|">OK</button>
  </form>

  <hr>

  <!-- Table to display students -->
  <form th:action="@{/add-grade-servlet}" method="post">
    <div class="form-section">
      <label>Intitulé du contrôle</label>
      <input type="text" name="gradeName" class="input-field" required>

      <label>Choix Coefficient</label>
      <input type="text" name="gradeCoefficient" class="input-field" required>
    </div>

    <input type="hidden" name="courseId" th:value="${courseId}">
    <input type="hidden" name="teacherId" th:value="${teacherId}">

    <div class="notes-table">
      <h3>Liste des étudiants</h3>
      <table style="width: 100%; border-collapse: collapse; text-align: left;">
        <thead>
        <tr>
          <th>Prénom</th>
          <th>Nom</th>
          <th>Email</th>
          <th>Note</th>
        </tr>
        </thead>
        <tbody>
        <tr th:each="student : ${students}">
          <td th:text="${student.userName}"></td>
          <td th:text="${student.userLastName}"></td>
          <td th:text="${student.userEmail}"></td>
          <td>
            <input type="number" th:name="'grade_' + ${student.userId}"
                   min="0" max="20" step="0.1" placeholder="Note" required>
          </td>
        </tr>
        <tr th:if="${#lists.isEmpty(students)}">
          <td colspan="4" style="text-align: center;">Aucun étudiant trouvé</td>
        </tr>
        </tbody>
      </table>
    </div>

    <button type="submit" class="submit-button" style="margin-top: 20px;">Valider toutes les notes</button>
  </form>
</div>
</body>
</html>
